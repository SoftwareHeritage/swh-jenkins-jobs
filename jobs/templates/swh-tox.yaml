- job-template:
    name: swh-{name}/tox
    node: swh-tox
    auth-token: ph4br1cat0r
    parameters:
      - string:
          name: REPO
          description: PHID of the Diffusion repository
      - string:
          name: PHID
          description: PHID of the Target object
      - string:
          name: URI
          description: URI of the repo
      - string:
          name: COMMIT
          description: commit ID to test, if any
      - string:
          name: DIFF_ID
          description: ID of the Diff patch to apply, if any
    scm:
      - git:
          url: https://forge.softwareheritage.org/source/swh-{name}.git

    wrappers:
      - phabricator-differential


    builders:
      - shell: |
          if [ -n $COMMIT ]; then
          echo "Checkout commit $COMMIT"
          git checkout $COMMIT
          fi
      - shell: python3 -m tox

    publishers:
      - phabricator:
          uberalls-enabled: false
          comment-with-console-link-on-failure: true
