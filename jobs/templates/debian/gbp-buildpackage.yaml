- job-template: &gbp_buildpackage
    name: "debian/packages/{name}/gbp-buildpackage"
    description: |
      Build Debian package
    deb-extra-repositories: ""
    deb-backport-on-success: unstable-swh>buster-swh
    project-type: pipeline
    properties:
      - build-discarder:
          num-to-keep: 10
    parameters:
      - string:
          name: GIT_REVISION
          default: debian/unstable-swh
          description: Git revision to build
      - string:
          name: EXTRA_REPOSITORIES
          description: |
            comma-separated extra repositories needed to build this package:
              - incoming: The buildd incoming repository (default for builds from unstable)
              - backports: The debian backports repository (default for builds for stable-swh)
              - swh: The Software Heritage debian repository (default for builds for swh branches)
              - ceph: The ceph repository
              - pgdg: PostgreSQL Global Dvt Group repository (for stable-swh builds requiring latest postgresql)
              - elasticsearch: Elasticsearch 7.x repository (for builds requiring elasticsearch installed)
              - cassandra: Cassandra 4.x repository (for builds requiring cassandra installed)
          default: "{deb-extra-repositories}"
      - choice:
          name: BUILD_DEP_RESOLVER
          description: |
            the sbuild build dependency resolver (overrides the automatic detection)
          choices:
            - ""
            - apt
            - aptitude
      - bool:
          name: DO_UPLOAD
          description: upload the built package
          default: false
      - string:
          name: BACKPORT_ON_SUCCESS
          description: |
            comma-separated: If the build is successful, which backports should we perform?
            - unstable-swh>stretch-swh
            - unstable-swh>buster-swh
            - unstable-swh>bullseye-swh
            - buster-swh>stretch-swh
          default: "{deb-backport-on-success}"
    dsl: !include-jinja2: gbp-buildpackage.groovy.j2

- job-template:
    name: "debian/deps/{name}/gbp-buildpackage"
    <<: *gbp_buildpackage
