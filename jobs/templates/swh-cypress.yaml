- job-template:
    name: "{name}/cypress"
    display-name: "master branch (cypress)"
    project-type: pipeline
    docker_image: cypress
    triggers:
      - timed: '@daily'
    sandbox: true
    auth-token: 'ph4br1cat0r'
    properties:
      - build-discarder:
          num-to-keep: 20
    parameters:
      - git-parameter:
          name: REVISION
          type: PT_REVISION
          defaultValue: master
          description: Git revision to build.
      - string:
          name: PHID
          description: PHID of the Phabricator target object on which results will be reported.

    dsl: |
      pipeline {{
        stages {{
          stage ('Fail unconditionally') {{
            steps {{
              echo 'This job has been merged into {name}/tests; it is only kept for historical purposes'
              sh 'exit 1'
            }}
          }}
        }}
      }}



- job-template:
    name: "{name}/cypress-diff"
    display-name: 'Phab. Diff (cypress)'
    docker_image: cypress
    node: "swh-{docker_image}"
    auth-token: ph4br1cat0r
    parameters:
      - string:
          name: REPO
          description: PHID of the Diffusion repository
      - string:
          name: PHID
          description: PHID of the Target object
      - string:
          name: DIFF_ID
          description: ID of the Diff patch to apply, if any
    scm:
      - git:
          url: https://forge.softwareheritage.org/source/{repo_name}.git
          branches:
            - origin/master

    builders:
      - shell: |
          echo "This job is only kept for historical purposes; please run {name}/tests-on-diff instead"
          exit 1
