stage('Rust tests') {
  {% filter indent(width=2) %}
    {%- include 'includes/agent-docker.groovy.j2' -%}
  {% endfilter %}

  steps {
    sh '''\
      set -e
      prepare-cargo-cache
      cargo clippy --all-features -- --deny warnings
      RUSTDOCFLAGS="--deny warnings" cargo doc --all-features
      cargo test --all-features
    '''
  }
}
